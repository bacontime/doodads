<!DOCTYPE html>
<html>
<head>
<title>RSS Feed Test</title>
<style>
  .videoBlock {
    border: 1px solid lightblue;
    min-height: 60px;
  }
  .videoBlock:hover {
    background-color: aliceblue;
  }
  .videoBlock a {
    text-decoration: none !important;
  }
  .videoBlock h3 {
    margin-bottom: 0rem;
    margin-top: 0.5rem;
  }
  .videoBlock img {
    float: left;
    margin-right: 1rem;
    height: 60px;
  }
  .videoBlock .metadata {
    color: lightgray;
  }
  </style>
</head>
<body>

<div id="feed"></div>

<script>
// THE FOLLOWING VARIABLE SHOULD BE MODIFIED TO CHANGE THE LIST OF CHANNELS SAMPLED
// CHANNEL IDS CAN BE FOUND ON A CHANNEL VIA RIGHT-CLICK, VIEW SOURCE, CTRL-F FOR RSS
// Look for url of the form https://www.youtube.com/feeds/videos.xml?channel_id=CHANNELID
const channelIds = [
  'UCcMXHcc7fikiJ-PhrGUeQoQ', // Gatis Kandis
  'UCMy7mRjghOxB8h3nv60SU4w', // CM Koseman
  'UC9gFih9rw0zNCK3ZtoKQQyA', // Jenna Marbles  
  'UCZXAVdAplsu1tFZ9OqQhJFg', // Virtual Frog
  'UCKxebVRFoRz5VSIHixMWNZg', // Alexander Wales
  'fake' // For error testing
]

//------------------------------------------------------------------------------------

const feedContainer = document.getElementById('feed');
const proxyserver = 'https://corsproxy.io/?'
const youtubeRSSprefix = 'https://www.youtube.com/feeds/videos.xml?channel_id=' 
function channelIdToUrl(id){ return proxyserver + youtubeRSSprefix + id;};

function formatVideoBlock(author, title, videoId, date){
  date = new Date(date);
  date = date.toDateString();
  return `
    <a href="https://www.youtube.com/v/${videoId}">
      <img src="https://i3.ytimg.com/vi/${videoId}/hqdefault.jpg"/>
      <h3>${title}</h3>
      <div class="metadata">${author} - ${date}</div>
    </a>
    `
}



promises = channelIds.map(id => fetch(channelIdToUrl(id))
  .then(response => response.text())
  .then(text => new window.DOMParser().parseFromString(text, "application/xml"))
);

Promise.all(promises).then(data => {
  videoList = []; 
  //grab data for first video from each channel
  data.forEach(feed => {
    try{
    item = feed.querySelector('entry');
      title = item.querySelector('title').textContent;
      videoId = item.querySelector('videoId').textContent;
      date = item.querySelector('published').textContent;
    author = feed.querySelector('title').textContent;
    console.log(author, videoId);
    videoList.push([author, title, videoId, date]);
    }
    catch (error){console.log(error)} // Just ignore the channels that weren't parsed right.
  });
  //sort list in reverse order by date
  videoList.sort(function(a,b){return b[3].localeCompare(a[3]);});
  //create a little entry for each video
  videoList.forEach(video => {
    videoBlock = document.createElement('div');
    videoBlock.setAttribute('class', 'videoBlock');
    videoBlock.innerHTML = formatVideoBlock(video[0],video[1],video[2], video[3]);
    feedContainer.appendChild(videoBlock);
  });
});







</script>
</body>
</html>
